<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>luatesting - micro-pico-tiny framework for Lua unit testing</title>
		<meta name="description" content="Minimalist open-source software for *nix and embedded systems" />
		<meta name="keywords" content="zserge, minimalism, unix, embedded" />
		<link href='http://fonts.googleapis.com/css?family=Lustria' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="/style.css" />
		<script type="text/javascript">

			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-33644825-1']);
			_gaq.push(['_trackPageview']);

			(function() {
			 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			 })();

		 </script>
	</head>
	<body>
		<div class='menu'>/*
			<ul class='menu'>
				<li><a href="/">home</a></li>
				<li><a href="/projects.html">code</a></li>
				<li><a href="/blog.html">blog</a></li>
			</ul>*/
		</div>
		<h1>Luatesting</h1>
<p>luatesting was born in sin, because the reason to create is was a 
<a href="http://en.wikipedia.org/wiki/Not_invented_here">NIH</a> principle
(Not Invented Here).</p>
<h2>Philosophy</h2>
<p>Yes, I know about <a href="http://en.wikipedia.org/wiki/XUnit">xUnit</a>. 
But I don't like it. 
It is good for huge enterprise-level apps. But I don't write 
enterprise apps.
It is good for object-oriented languages. But Lua is not that
object-oriented.</p>
<p>Have you heard about Go language <a href="http://golang.org/pkg/testing/">testing</a>
package? That's what I kept in mind when writing luatesting.</p>
<h2>Code</h2>
<p>The code repository is stored on 
<a href="https://bitbucket.org/zserge/luatesting/">bitbucket</a></p>
<p>API is simple - there is just one function: <code>testing.run()</code></p>
<p>You should use it like:</p>
<pre><code>MyTestCase = {}
function MyTestCase.test_some_stuff(t)
    ....
end
function MyTestCase.test_other_stuff(t)
    ....
end

local testing = require("luatesting")
testing.run()
</code></pre>
<p>When <code>testing.run()</code> is called - all your global tables are scanned, and
all methods containing the word "test" in the name are called.</p>
<p>Sounds easy?</p>
<h2>How to test</h2>
<p>That was how to organize your test cases. Now let's see how to test a
single case. </p>
<p>Every test case gets a single parameter - an object, called <code>t</code>.</p>
<p>There is no <code>assertEquals()</code> and friends, just a single object to report
you test state. The <code>t</code> object has two methods:</p>
<ul>
<li><code>t.Error(msg)</code> - print a message, mark this test as failed, but continue
    running this test. There can be several errors in a single test</li>
<li><code>t.Fail(msg)</code> - print a message, mark test as failed and terminate it</li>
</ul>
<p>If nothing was done to the <code>t</code> object - the test is passed successfully.</p>
<p>Here's an example of a test case:</p>
<pre><code>ParserTest = {
    p = parser_create()
}

function ParserTest:test_single_number(t)
    n = self.p:parse("123")
    if n ~= 123 then 
        t.Error("Failed to parse 123") 
    end

    n = self.p:parse("0.123")
    if n ~= 0.123 then 
        t.Error("Failed to parse 0.123") 
    end
end

function ParserTest: test_array(t)
    a = self.p:parse("[ item1, item2, item3 ]")
    if #a ~= 3 then
        -- We fail here, because there is no reason to continue
        t.Fail("Array length is not 3")
    end

    if a[0] ~= "item1" or a[1] ~= "item2" or a[2] ~= "item3" then
        t.Error("Array contents are wrong")
    end
end

testing = require("luatesting")
testing.run()
</code></pre>
<p>Here's good output:</p>
<pre><code>OK: test_single_number
OK: test_array
</code></pre>
<p>If something goes wrong you will see messages like this:
    ERR:    Failed to parse 123
    ERR:    Failed to parse 0.123
    FAIL: Error length is not 3</p>
<h2>Other info</h2>
<p>My experience with Lua is VERY little, so if it's not enough Lua-esque - 
let me know how to improve it. Thanks!</p>
	</body>
</html>
