<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, minimumscale=1.0, maximum-scale=1.0" />
		<title> How to sign release apk with gradle </title>
		<meta name="description" content="Signing apks without boilerplate code" />
		<meta name="keywords" content="android, signing, gradle, release, keystore" />
		<link href='http://fonts.googleapis.com/css?family=Crimson+Text:400,400italic,600,600italic,700,700italic' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="/styles.css" />
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-33644825-1', 'zserge.com');
			ga('send', 'pageview');
		</script>
	</head>
	<body>
		<nav class='menu'>/*
			<ul class='menu'>
				<li><a class='menu-link' href="/">home</a></li>
				<li><a class='menu-link' href="/projects.html">code</a></li>
				<li><a class='menu-link' href="/blog.html">blog</a></li>
			</ul>*/
		</nav>
		<h1>How to sign release apk with gradle</h1>

<p>Whenever I prepare my APK for the release - I used to do the following steps:</p>

<ol>
<li>Copy keystore to the project directory</li>
<li>Copy gradle.properties into the project directory with keystore name, alias
 and password defined</li>
<li>Copy some code from <a href="https://www.timroes.de/2013/09/22/handling-signing-configs-with-gradle/">some blog</a> that would load the properties and set up
 the signing</li>
<li>Finally, do 'gradle build'</li>
</ol>

<p>But why not to move the boilderplate out of build.gradle?</p>

<h2>Helper signing script</h2>

<p>I wrote a tiny helper script that can be included into the projects:</p>

<pre><code>def signingProperties = &quot;signing.properties&quot;
def signingKeys = [
    storeFile     : {x -&gt; file(x)},
    storePassword : {x -&gt; x},
    keyAlias      : {x -&gt; x},
    keyPassword   : {x -&gt; x},
]

// Find signing.properties in the project root, or in $HOME/.gradle
def f = [&quot;${rootDir}/${signingProperties}&quot;, &quot;${gradle.gradleUserHomeDir}/${signingProperties}&quot;].find { file(it).exists() }

if (f) {
    logger.info &quot;Loading signing properties from ${f}&quot;
    def props = new Properties()
    props.load(new FileInputStream(f))

    // For each property apply it to the release signing config
    signingKeys.any { k, fn -&gt;
        if (!props.containsKey(k)) {
            logger.error &quot;Missing property ${k}&quot;
            android.buildTypes.release.signingConfig = null
            return true
        }
        android.signingConfigs.release[k] = fn(props[k]);
        return
    }
} else {
    logger.info &quot;Missing ${signingProperties} file&quot;
    android.buildTypes.release.signingConfig = null
}
</code></pre>

<p>It scans for the signing.propeties file in the project directory and in the
gradle home directory, then it parses the properties and configures the build.</p>

<h2>usage</h2>

<p>Now I do the following.</p>

<p>Create signing.properties in my $HOME/.gradle (once for all projects):</p>

<pre><code>storeFile=my.keystore
keyAlias=myalias
storePassword=mypassword
keyPassword=mypassword2
</code></pre>

<p>Put my.keystore into $HOME/.gradle (once for all projects).</p>

<p>Edit build.gradle to use release singing config (most likely it is already done
did it the app has been signed in the past):</p>

<pre><code>android {
    signingConfigs {
        release
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
        }
    }
}
</code></pre>

<p>Finally, I include the script above. I simply use the github link:</p>

<pre><code>apply from: 'https://raw.github.com/trikita/gradle-android-signing/master/gradle-android-signing.gradle'
</code></pre>

<p>Done. One 'apply from' line and signing just works.</p>

<p>You may try it, too. Sources are available on <a href="https://github.com/trikita/gradle-android-signing">github</a>, so please file an
issue or a pull request if something it not working.</p>

<p>Posted on 2015-08-09 <span class='rss' style='float: right;'>[<a href="/rss.xml">rss</a>]</span></p>

<p><script type="text/javascript">(function() {
  if (window.pluso)if (typeof window.pluso.start == 'function') return;
  if (window.ifpluso==undefined) { window.ifpluso = 1;
    var d = document, s = d.createElement('script'), g = 'getElementsByTagName';
    s.type = 'text/javascript'; s.charset='UTF-8'; s.async = true;
    s.src = ('https:' == window.location.protocol ? 'https' : 'http')  + '://share.pluso.ru/pluso-like.js';
    var h=d[g]('body')[0];
    h.appendChild(s);
  } })();</script>
<div class="pluso" data-lang="en" data-background="transparent" data-options="medium,round,line,horizontal,nocounter,theme=02" data-services="facebook,twitter,google,vkontakte,email" data-url="http://zserge.com" data-title="zserge's blog" data-description="My thoughts on software and simplicity"></div></p>

<p><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname='zserge';
    (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>
</noscript></p>

<p>http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Signing-Configurations</p>

		<footer></footer>
	</body>
</html>

