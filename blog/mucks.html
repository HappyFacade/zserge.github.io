<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, minimumscale=1.0, maximum-scale=1.0" />
		<title> mucks: automating screen and tmux </title>
		<meta name="description" content="mucks - a session manager for screen and tmux" />
		<meta name="keywords" content="" />
		<link href='http://fonts.googleapis.com/css?family=Quando' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Buenard' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="/styles.css" />
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-33644825-1', 'zserge.com');
			ga('send', 'pageview');
		</script>
	</head>
	<body>
		<div class='menu'>/*
			<ul class='menu'>
				<li><a href="/">home</a></li>
				<li><a href="/projects.html">code</a></li>
				<li><a href="/blog.html">blog</a></li>
			</ul>*/
		</div>
		
<h1>mucks: automating screen and tmux</h1>

<p>I can't imagine my daily work in terminal without multiplexers.
I used to use GNU Screen a couple of years ago, then I switched to Tmux.</p>

<p>There has been a lot of talks about screen vs tmux, and then vs byubu. I still
use both, and I still like both. What I was really missing is session
management.</p>

<p>Since my laptop's uptime is normally more than a month - I just created windows
manually and started programs manually and then just attached/detached until
the next reboot. Honestly, I never heard about session management tools until
yesterday. Then I stumbled upon tmuxinator...</p>

<p>Install ruby to just manage terminal sessions?! What's wrong with this world?!</p>

<p>So, I quickly googled for other alternatives, and found that most of them are
tmux-oriented, and it seems like nobody cares about the good old GNU Screen.</p>

<p>That's how I started my own session manager for both, tmux and screen.</p>

<h2>mucks</h2>

<p>Mucks (btw, it also means "protest" in German) is written in UNIX Shell, and I
hope has no bashisms. Seems like the only external program it uses (other than
screen and tmux) is sed, so in theory it should be highly portable.</p>

<p>It's also just one file of ~100LOC, so it should not be hard to read or to
install it. I also tried to do some tests at least for the configuration parser
(right, there are test frameworks for UNIX Shell as well).</p>

<p>So, just download the sources (or at least one <a href="https://bitbucket.org/zserge/mucks/raw/1162dd436dcc72aafae6fef1a62b16a247fcdc92/mucks">mucks</a> file) - and you're ready to use it:</p>

<pre><code>hg clone https://bitbucket.org/zserge/mucks
</code></pre>

<p>Now let's create a simple session</p>

<h2>sessions</h2>

<p>Each session is described in a separate configuration file. You may store all your session files in your home directory and run them as:</p>

<pre><code>$ mucks ~/myproject.mucksrc
</code></pre>

<p>Or you may store session configurations inside the project directories:</p>

<pre><code>$ cd ~/myproject # There should be a file called .mucksrc
$ mucks          # It picks .mucksrc automatically
</code></pre>

<p>Here's an example of such a mucksrc file I just used:</p>

<pre><code>#
# Mucks project
#
name: mucks
dir: /home/serge/src/serge/mucks
mux: tmux

[vim]
vim mucks test.sh mucksrc.example -p

[shell]

[man]
man tmux
- vsplit
man screen
</code></pre>

<p>Here's how it looks in my tmux and screen:</p>

<p><img src="/images/mucks1.png" alt="Screen" title="" /></p>

<p><img src="/images/mucks2.png" alt="Tmux" title="" /></p>

<p>You may see on tmux the screen is split in two for man pages, while in screen
these are still two separate windows (not panes). This is because of the
different nature of how screen and tmux handle panes - in screen panes are not
parts of the window, but are rather global for the whole session (each pane
contains all of the windows). Also, in screen splits disappear during the
detach, so I decided to create new windows for screen splits, so user still
could manually organize them if he wants.</p>

<h2>language</h2>

<p>There are two sections in each session config - a header with global session
 settings and a layout section with the list of windows.</p>

<p>Header is just a list of variables and their values separated by a colon:</p>

<pre><code>name: My project
foo: bar
</code></pre>

<p>At the moment only the following variables are supported:</p>

<ul>
<li>name - name of the session, it is used for the terminal window title</li>
<li>dir - a working directory of the session. Handy if you want to run mucks from any directory outside of the project</li>
<li>mux - which multiplexor to use. Possible values are "tmux" or "screen"</li>
</ul>

<p>Layout section looks like an INI file, each window title is a section and
 below is text to be typed into the window and some internal commands to be
 performed:</p>

<pre><code># This opens a window called "code editor"
# running vim with list of files shown
[code editor]
vim
ihello^[
</code></pre>

<p>Yes, section body is not a shell command, but exact keys to be typed into the
window. It allows to run some vim commands like 'gt' or to open certain web
pages in w3m, or open ssh sessions and do something remotely.</p>

<p>Every line that starts with a dash ("-") is an internal command. These are now
used to set up pane layout, but probably later they will be more powerful. At
the moment only "hsplit" and "vsplit" commands are supported - they split
current window horizontally or vertically (sorry, that works only in tmux, as
mentioned above).</p>

<p>As you can see, session configuration file is extremely simple, yet it can
save a lot of typing for complex sessions.</p>

<h2>what's next?</h2>

<p>For my humble needs even the current version of mucks is usable. Adding more
features?  I can think of more complex layouts, proportional splits etc.  Also
I'd like to have automatic detection of tmux and screen depending on which one
is available.</p>

<p>Probably I should add the support of byubu and wemux.</p>

<p>I would be happy to add the support of dvtm, they have added a fifo to send
internal commands to a running dvtm instance recently, but I'm not sure how
flexible it is now.</p>

<p>And how do you use terminal multiplexor sessions?</p>

<p>Posted on 2014-04-25 <span class='rss' style='float: right;'>[<a href="/rss.xml">rss</a>]</span></p>

<p><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname='zserge';
    (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script></p>

<noscript>
</noscript>
	</body>
</html>

