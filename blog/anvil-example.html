<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, minimumscale=1.0, maximum-scale=1.0" />
		<title> Anvil: the first example app </title>
		<meta name="description" content="A clone of a CoundDone app written with Anvil" />
		<meta name="keywords" content="anvil, android, mvc, example, countdone" />
		<link href='http://fonts.googleapis.com/css?family=Crimson+Text:400,400italic,600,600italic,700,700italic' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="/styles.css" />
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-33644825-1', 'zserge.com');
			ga('send', 'pageview');
		</script>
	</head>
	<body>
		<nav class='menu'>/*
			<ul class='menu'>
				<li><a class='menu-link' href="/">home</a></li>
				<li><a class='menu-link' href="/projects.html">code</a></li>
				<li><a class='menu-link' href="/blog.html">blog</a></li>
			</ul>*/
		</nav>
		<p>I tried to use Anvil in some real project, which is a shameless clone of the
[CountDone] iOS app.</p>

<p>The core of the app is a simple countdown timer. You create a new task and set
the expected deadline for it.  The timer starts counting and if you finished
the task before it expired - you click &quot;Done&quot; and get a completed tasks. If you
failed - you will get a failed task.</p>

<p>Finished tasks can be removed or re-started again.</p>

<p>In terms of UI the app has just two screens. The first one contains a list of
tasks and button to create a new task. The second one displays the info about
the current task and allows you to finish it or to edit it.</p>

<p>Below I will list some good points of the new Anvil approach.</p>

<h2>Isolated model</h2>

<p>I started with model. It resulted in an absolutely isolated class that did not
depend on my UI at all. I know that in most of the android apps models are
isolated from view, but in Anvil you simply have no way to mix them together.</p>

<p>Advantage: isolated model brings you nice unit testing.</p>

<h2>Single activity</h2>

<p>I followed the approach suggested by <a href="...">Square</a> and I used a single activity
and views instead of fragments. This made me to re-invent the backstack.
For this app it was trivial. For future I'm thinking about making a tiny helper
similar to [Flow]() that would play nicely with Anvil.</p>

<p>Advantage: single activity means no more pain with weird exceptions in
fragments.</p>

<h2>Saving instance of my views</h2>

<p>Each view, much like Activity or Fragment has their own calls
onSaveInstanceState() and onRestoreInstanceState(). For my renderable views I
created two helper methods, onLoad() and onSave() that receive Bundles instead
of returning Parcelables. This simplifies code a bit.</p>

<h2>Testing</h2>

<p>Models are tested like normal Java classes with no dependencies.</p>

<p>Views are tested with Robolectric.application context. Probably one could also
use Mockito to mock the cursed Context class of the android.jar.</p>

<p>Tests are very easy to write, since all logic is now untangled. Your tests are
basically of two types now:</p>

<ul>
<li>verify controller: call a listener and see if the controller variable has changed</li>
<li>verify view: set controller variables to some values and inflate the layout,
now check if the resulted layout has correct properties (widgets, text,
colors...)</li>
</ul>

		<footer></footer>
	</body>
</html>

